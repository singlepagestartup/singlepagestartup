## CRM Integration Map (шаблон для ИИ-агента)

Внимание: шаблон предназначен для автоматического заполнения ИИ-агентом на основе входных артефактов: Integration_Map.md, Analytics_Tracking_Spec.md, Website_Deployment_Report.md. Не добавлять произвольных полей, не предусмотренных структурой.

---

### 1. Основная информация

- **Название проекта:** [указать из Integration_Map.md → Раздел 1]
- **Клиент:** [указать из Integration_Map.md → Раздел 1]
- **Дата настройки:** [указать]
- **Ответственный:** Marketing Automation Specialist
- **Источники данных:** Integration_Map.md, Analytics_Tracking_Spec.md, Website_Deployment_Report.md

---

### 2. Интеграционные цепочки

| Источник            | Получатель                                                | Метод                       | URL / Endpoint                                                                                    | Передаваемые данные                                                                                  | Источник данных                                                           | Требуется ручная работа                                                                                  |
| ------------------- | --------------------------------------------------------- | --------------------------- | ------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| Сайт (форма заявки) | CRM                                                       | Webhook / REST API          | [URL webhook или API endpoint из Integration_Map.md → Раздел 2]                                   | Имя, телефон, email, utm_source, utm_medium, utm_campaign, utm_content, form_id, client_id, page_url | Integration_Map.md → Раздел 2 → №1                                        | Да (человек должен проверить доступность webhook/API, валидность токенов, права доступа)                 |
| CRM                 | ESP                                                       | API / Segment Sync          | [URL API endpoint из Integration_Map.md → Раздел 3]                                               | Email, статус лида (new, in_progress, closed), продукт, lead_id, subscriber_id                       | Integration_Map.md → Раздел 3 → №1                                        | Да (человек должен проверить подключение API, валидность ключей, синхронизацию сегментов)                |
| CRM                 | Analytics (GA4, Meta, Яндекс Метрика, VK Pixel, OK Pixel) | Conversion API / Event Push | [URL Conversion API из Integration_Map.md → Раздел 2 → №4, Analytics_Tracking_Spec.md → Раздел 1] | Lead ID, value, status, client_id, email (hashed), phone (hashed), external_id                       | Integration_Map.md → Раздел 2 → №4, Analytics_Tracking_Spec.md → Раздел 1 | Да (человек должен проверить работу Conversion API, валидность токенов, регистрацию событий в аналитике) |
| ESP                 | CRM                                                       | API / Webhook               | [URL webhook из Integration_Map.md → Раздел 4]                                                    | Email, статус подписки (subscribed, unsubscribed, bounced), subscriber_id, campaign_id               | Integration_Map.md → Раздел 4 → №1                                        | Да (человек должен проверить работу webhook, синхронизацию данных)                                       |
| Analytics (GA4)     | CRM                                                       | Measurement Protocol / API  | [URL Measurement Protocol из Analytics_Tracking_Spec.md → Раздел 1]                               | client_id, events (view_item, purchase, form_submit), user_id                                        | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 5      | Нет (ИИ анализирует через данные)                                                                        |

---

### 3. Сопоставление полей (Field Mapping)

| Поле на сайте / Источник    | Поле в CRM                 | Тип данных | Обязательное | Трансформация / Формат                                                                   | Источник данных                                                                     | Требуется ручная работа                                                                  |
| --------------------------- | -------------------------- | ---------- | ------------ | ---------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| name / form.name            | full_name / contact.name   | string     | ✅           | [указать формат, например: "Имя Фамилия" или разделение на first_name и last_name]       | Website_Deployment_Report.md → Раздел 4 → Формы, Integration_Map.md → Раздел 2 → №1 | Да (человек должен проверить соответствие полей в CRM, создание недостающих полей в CRM) |
| phone / form.phone          | phone / contact.phone      | string     | ✅           | [указать формат, например: +7XXXXXXXXXX или валидация через regex]                       | Website_Deployment_Report.md → Раздел 4 → Формы, Integration_Map.md → Раздел 2 → №1 | Да (человек должен проверить валидацию телефона, формат в CRM)                           |
| email / form.email          | email / contact.email      | string     | ✅           | [указать валидацию email, lowercase]                                                     | Website_Deployment_Report.md → Раздел 4 → Формы, Integration_Map.md → Раздел 2 → №1 | Да (человек должен проверить валидацию email, формат в CRM)                              |
| utm_source / URL параметр   | source / lead.source       | string     | ✅           | [указать допустимые значения из Analytics_Tracking_Spec.md → Раздел 1 или UTM-конвенция] | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №1           | Нет (ИИ анализирует через данные)                                                        |
| utm_medium / URL параметр   | medium / lead.medium       | string     | ✅           | [указать допустимые значения из Analytics_Tracking_Spec.md → Раздел 1]                   | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №1           | Нет (ИИ анализирует через данные)                                                        |
| utm_campaign / URL параметр | campaign / lead.campaign   | string     | ❌           | [указать формат]                                                                         | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №1           | Нет (ИИ анализирует через данные)                                                        |
| utm_content / URL параметр  | content / lead.content     | string     | ❌           | [указать формат]                                                                         | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №1           | Нет (ИИ анализирует через данные)                                                        |
| form_id / form.id           | form / lead.form           | string     | ❌           | [указать ID формы из Website_Deployment_Report.md]                                       | Website_Deployment_Report.md → Раздел 4 → Формы, Integration_Map.md → Раздел 2 → №1 | Нет (ИИ анализирует через данные)                                                        |
| value / form.value          | lead_value / deal.value    | number     | ❌           | [указать валюту, формат]                                                                 | Website_Deployment_Report.md → Раздел 4 → Формы, Integration_Map.md → Раздел 2 → №1 | Да (человек должен проверить корректность передачи суммы, валюту в CRM)                  |
| client_id / GA4             | client_id / lead.client_id | string     | ✅           | [указать формат, например: UUID или timestamp-based]                                     | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 6                | Нет (ИИ анализирует через данные)                                                        |
| page_url / form.page_url    | page_url / lead.page_url   | string     | ❌           | [указать формат URL]                                                                     | Website_Deployment_Report.md → Раздел 3, Integration_Map.md → Раздел 2 → №1         | Нет (ИИ анализирует через данные)                                                        |

---

### 4. Идентификаторы и отслеживание

| Система        | Идентификатор | Описание                                                 | Формат                                                      | Правила синхронизации                                                | Источник данных                                                                 | Требуется ручная работа                                                                |
| -------------- | ------------- | -------------------------------------------------------- | ----------------------------------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| GA4            | client_id     | Генерируется браузером, сохраняется в cookie             | [указать формат, например: 1234567890.1234567890]           | Синхронизируется с CRM через Conversion API или Measurement Protocol | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 6, Раздел 10 | Да (человек должен проверить генерацию client_id, корректность передачи в CRM)         |
| CRM            | lead_id       | Уникальный ID заявки, создается при создании лида        | [указать формат, например: UUID или последовательный номер] | Передается в ESP и Analytics для связи данных                        | Integration_Map.md → Раздел 6, Раздел 10                                        | Нет (ИИ анализирует через данные)                                                      |
| CRM            | contact_id    | Уникальный ID контакта                                   | [указать формат]                                            | Используется для связи лидов и сделок с контактом                    | Integration_Map.md → Раздел 6, Раздел 10                                        | Нет (ИИ анализирует через данные)                                                      |
| ESP            | subscriber_id | ID подписчика в ESP                                      | [указать формат]                                            | Синхронизируется с CRM через email (основной идентификатор)          | Integration_Map.md → Раздел 4, Раздел 6, Раздел 10                              | Да (человек должен проверить синхронизацию subscriber_id с CRM)                        |
| Meta / TikTok  | external_id   | Передается через Conversion API                          | [указать формат, например: hashed email или phone]          | Связывается с client_id через Conversion API                         | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №4       | Да (человек должен проверить работу Conversion API, корректность передачи external_id) |
| Яндекс Метрика | client_id     | ID клиента в Яндекс.Метрике                              | [указать формат]                                            | Синхронизируется с CRM через события                                 | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №3       | Да (человек должен проверить работу Яндекс.Метрики, синхронизацию с CRM)               |
| VK Pixel       | external_id   | ID пользователя во ВКонтакте                             | [указать формат]                                            | Связывается с client_id через события                                | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №3       | Да (человек должен проверить работу VK Pixel, синхронизацию с CRM)                     |
| OK Pixel       | external_id   | ID пользователя в Одноклассниках                         | [указать формат]                                            | Связывается с client_id через события                                | Analytics_Tracking_Spec.md → Раздел 1, Integration_Map.md → Раздел 2 → №3       | Да (человек должен проверить работу OK Pixel, синхронизацию с CRM)                     |
| Email          | email         | Основной идентификатор для синхронизации между CRM и ESP | [указать формат, например: lowercase, валидация]            | Email является основным идентификатором для связи между CRM и ESP    | Integration_Map.md → Раздел 6, Раздел 10                                        | Да (человек должен проверить валидацию email, формат в обеих системах)                 |

---

### 5. Проверка и тестирование интеграций

#### 5.1. Проверка интеграции сайт → CRM

| Проверка                         | Метод                                  | Результат | Детали проверки                                                                                 | Источник данных                                                           | Требуется ручная работа                                                           |
| -------------------------------- | -------------------------------------- | --------- | ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- | --------------------------------------------------------------------------------- |
| Форма на сайте (отправка заявки) | Тестовая отправка через форму на сайте | ✅ / ❌   | [указать: URL формы, название формы, поля формы, результат отправки]                            | Website_Deployment_Report.md → Раздел 4 → Формы                           | Да (человек должен реально отправить тестовую заявку через форму на сайте)        |
| CRM запись (создание лида)       | Проверка лида в CRM                    | ✅ / ❌   | [указать: lead_id созданного лида, все переданные поля, статус лида, соответствие полей]        | Integration_Map.md → Раздел 2 → №1                                        | Да (человек должен проверить создание лида в CRM, открыть CRM и проверить запись) |
| Передача UTM-параметров          | Проверка UTM в CRM                     | ✅ / ❌   | [указать: utm_source, utm_medium, utm_campaign, utm_content в CRM, соответствие URL параметрам] | Integration_Map.md → Раздел 2 → №1, Analytics_Tracking_Spec.md → Раздел 1 | Да (человек должен проверить UTM-параметры в CRM, сравнить с URL)                 |
| Передача client_id               | Проверка client_id в CRM               | ✅ / ❌   | [указать: client_id в CRM, соответствие client_id из GA4]                                       | Integration_Map.md → Раздел 2 → №1, Analytics_Tracking_Spec.md → Раздел 1 | Да (человек должен проверить client_id в CRM, сравнить с GA4)                     |
| Валидация данных                 | Проверка формата данных                | ✅ / ❌   | [указать: валидность email, телефона, имени, соответствие форматам]                             | Integration_Map.md → Раздел 2 → №1                                        | Да (человек должен проверить валидацию данных в CRM)                              |

#### 5.2. Проверка интеграции CRM → ESP

| Проверка                              | Метод                             | Результат | Детали проверки                                                                  | Источник данных                              | Требуется ручная работа                                                                 |
| ------------------------------------- | --------------------------------- | --------- | -------------------------------------------------------------------------------- | -------------------------------------------- | --------------------------------------------------------------------------------------- |
| ESP запись (синхронизация подписчика) | Тест создания подписчика в ESP    | ✅ / ❌   | [указать: subscriber_id в ESP, email подписчика, статус подписки, сегмент]       | Integration_Map.md → Раздел 3 → №1           | Да (человек должен проверить создание подписчика в ESP, открыть ESP и проверить запись) |
| Синхронизация статуса лида            | Проверка обновления статуса в ESP | ✅ / ❌   | [указать: изменение статуса лида в CRM, обновление в ESP, соответствие статусов] | Integration_Map.md → Раздел 3 → №1           | Да (человек должен изменить статус лида в CRM и проверить обновление в ESP)             |
| Синхронизация по email                | Проверка связи по email           | ✅ / ❌   | [указать: email в CRM, email в ESP, соответствие subscriber_id и contact_id]     | Integration_Map.md → Раздел 3 → №1, Раздел 6 | Да (человек должен проверить соответствие email в CRM и ESP)                            |

#### 5.3. Проверка интеграции CRM → Analytics

| Проверка                            | Метод                                  | Результат | Детали проверки                                                                               | Источник данных                                                                     | Требуется ручная работа                                                      |
| ----------------------------------- | -------------------------------------- | --------- | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------- |
| GA4 событие (Conversion API)        | Проверка события в GA4                 | ✅ / ❌   | [указать: событие в GA4, параметры события (lead_id, value, status), соответствие данным CRM] | Integration_Map.md → Раздел 2 → №4, Analytics_Tracking_Spec.md → Раздел 1           | Да (человек должен проверить событие в GA4, открыть GA4 и проверить событие) |
| Meta Pixel событие (Conversion API) | Проверка события в Meta Events Manager | ✅ / ❌   | [указать: событие в Meta, параметры (external_id, value), соответствие данным CRM]            | Integration_Map.md → Раздел 2 → №4, Analytics_Tracking_Spec.md → Раздел 1           | Да (человек должен проверить событие в Meta Events Manager)                  |
| Яндекс Метрика событие              | Проверка события в Яндекс.Метрике      | ✅ / ❌   | [указать: событие в Яндекс.Метрике, параметры, соответствие данным CRM]                       | Integration_Map.md → Раздел 2 → №3, Analytics_Tracking_Spec.md → Раздел 1           | Да (человек должен проверить событие в Яндекс.Метрике)                       |
| VK Pixel событие                    | Проверка события в VK Ads              | ✅ / ❌   | [указать: событие во ВКонтакте, параметры, соответствие данным CRM]                           | Integration_Map.md → Раздел 2 → №3, Analytics_Tracking_Spec.md → Раздел 1           | Да (человек должен проверить событие в VK Ads)                               |
| OK Pixel событие                    | Проверка события в OK Ads              | ✅ / ❌   | [указать: событие в Одноклассниках, параметры, соответствие данным CRM]                       | Integration_Map.md → Раздел 2 → №3, Analytics_Tracking_Spec.md → Раздел 1           | Да (человек должен проверить событие в OK Ads)                               |
| Привязка client_id                  | Проверка связи client_id с lead_id     | ✅ / ❌   | [указать: client_id в GA4, lead_id в CRM, соответствие через Conversion API]                  | Integration_Map.md → Раздел 2 → №4, Раздел 6, Analytics_Tracking_Spec.md → Раздел 1 | Да (человек должен проверить привязку client_id к lead_id в обеих системах)  |

#### 5.4. Проверка интеграции ESP → CRM

| Проверка              | Метод                             | Результат | Детали проверки                                                                                              | Источник данных                    | Требуется ручная работа                                                                    |
| --------------------- | --------------------------------- | --------- | ------------------------------------------------------------------------------------------------------------ | ---------------------------------- | ------------------------------------------------------------------------------------------ |
| Webhook от ESP        | Проверка получения webhook от ESP | ✅ / ❌   | [указать: статус подписки (subscribed, unsubscribed, bounced), обновление в CRM, соответствие subscriber_id] | Integration_Map.md → Раздел 4 → №1 | Да (человек должен проверить получение webhook от ESP, открыть CRM и проверить обновление) |
| Синхронизация отписок | Проверка отписки в CRM            | ✅ / ❌   | [указать: изменение статуса подписки в ESP, обновление в CRM, соответствие статусов]                         | Integration_Map.md → Раздел 4 → №1 | Да (человек должен отписаться от рассылки в ESP и проверить обновление в CRM)              |

---

### 6. Технические детали интеграций

#### 6.1. Сайт → CRM (Webhook / REST API)

- **URL / Endpoint:** [указать из Integration_Map.md → Раздел 2 → №1]
- **Метод:** [указать: POST, GET, PUT]
- **Формат данных:** [указать: JSON, XML, Form Data]
- **Аутентификация:** [указать: API Key, Bearer Token, OAuth, Basic Auth]
- **Заголовки:** [указать: Content-Type, Authorization, User-Agent]
- **Таймаут:** [указать: например, 5 секунд]
- **Повторные попытки:** [указать: количество попыток, интервал]
- **Источник данных:** Integration_Map.md → Раздел 2 → №1, Раздел 8
- **Требуется ручная работа:** Да (человек должен проверить доступность endpoint, валидность токенов, права доступа, настройку webhook в CRM)

#### 6.2. CRM → ESP (API / Segment Sync)

- **URL / Endpoint:** [указать из Integration_Map.md → Раздел 3 → №1]
- **Метод:** [указать: POST, GET, PUT]
- **Формат данных:** [указать: JSON, XML]
- **Аутентификация:** [указать: API Key, Bearer Token, OAuth]
- **Заголовки:** [указать: Content-Type, Authorization]
- **Таймаут:** [указать: например, 10 секунд]
- **Повторные попытки:** [указать: количество попыток, интервал]
- **Синхронизация сегментов:** [указать: какие сегменты синхронизируются, частота синхронизации]
- **Источник данных:** Integration_Map.md → Раздел 3 → №1, Раздел 8
- **Требуется ручная работа:** Да (человек должен проверить подключение API, валидность ключей, синхронизацию сегментов, настройку интеграции в ESP)

#### 6.3. CRM → Analytics (Conversion API / Event Push)

- **URL / Endpoint:** [указать из Integration_Map.md → Раздел 2 → №4, Analytics_Tracking_Spec.md → Раздел 1]
- **Метод:** [указать: POST]
- **Формат данных:** [указать: JSON]
- **Аутентификация:** [указать: Access Token, API Key]
- **Заголовки:** [указать: Content-Type, Authorization]
- **Таймаут:** [указать: например, 5 секунд]
- **Повторные попытки:** [указать: количество попыток, интервал]
- **События:** [указать: какие события передаются: lead, purchase, form_submit]
- **Источник данных:** Integration_Map.md → Раздел 2 → №4, Analytics_Tracking_Spec.md → Раздел 1, Раздел 2
- **Требуется ручная работа:** Да (человек должен проверить работу Conversion API, валидность токенов, регистрацию событий в аналитике, настройку Conversion API в GA4/Meta/Яндекс.Метрике/VK/OK)

---

### 7. Выявленные проблемы и рекомендации

#### 7.1. Проблемы интеграций

| Проблема                      | Система           | Уровень критичности           | Описание                    | Влияние на работу                   | Рекомендации по исправлению           | Источник данных           |
| ----------------------------- | ----------------- | ----------------------------- | --------------------------- | ----------------------------------- | ------------------------------------- | ------------------------- |
| [указать проблему, если есть] | [указать систему] | Критично / Важно / Желательно | [указать описание проблемы] | [указать влияние на работу системы] | [указать рекомендации по исправлению] | [указать источник данных] |

#### 7.2. Рекомендации по улучшению

- [Указать рекомендации по улучшению интеграций, если есть]
- [Указать дополнительные проверки, которые стоит выполнить]
- [Указать оптимизации синхронизации данных]

---

### 8. Статус готовности и резюме

**Статус готовности интеграций:**

- ✅ **Сайт → CRM:** [Готов / Требует доработки / Не готов]
- ✅ **CRM → ESP:** [Готов / Требует доработки / Не готов]
- ✅ **CRM → Analytics:** [Готов / Требует доработки / Не готов]
- ✅ **ESP → CRM:** [Готов / Требует доработки / Не готов]

**Общий статус:** ✅ Готов / ⚠ Требует доработки / ❌ Не готов

**Резюме:**

- Все интеграции проверены и синхронизированы: [указать количество проверенных интеграций]
- Выявленные проблемы: [указать количество критичных/важных/желательных проблем]
- Рекомендации для следующих этапов: [указать рекомендации для 05_8_Email_Marketing_Infrastructure_Setup]

**Следующий этап:** 05_8_Email_Marketing_Infrastructure_Setup (Email Marketing Specialist)
