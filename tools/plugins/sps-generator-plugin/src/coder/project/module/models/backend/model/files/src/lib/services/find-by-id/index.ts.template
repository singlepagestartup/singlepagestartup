import { db } from "@sps/sps-db-provider";
import { model } from "<%= schema_table_module_lib_name %>";
import {
  Table,
  populate,
  config,
} from "<%= schema_module_lib_name %>";
import { eq } from "drizzle-orm";
import { transformData } from "@sps/shared-backend-api";

export async function service(props: { id: string }) {
  const { id } = props;

  const result = await db.query[model].findFirst({
    where: eq(Table.id, id),
    with: populate,
  });

  if (!result) {
    return null;
  }

  const transformedResult = transformData<typeof result, typeof config>({
    entity: result,
    config,
  });

  return transformedResult;
}
